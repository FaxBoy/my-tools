<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>金额最大化购买计算器（三款商品 + 表达式 + 自动跳过0）</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background: #f5f6fa;
            color: #333;
            max-width: 540px;
            margin: 40px auto;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            color: #0078d7;
            margin-bottom: 24px;
        }
        label {
            display: block;
            margin: 10px 0 4px;
        }
        input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 15px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            margin-top: 18px;
            padding: 10px;
            background: #0078d7;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #005ea6;
        }
        .result {
            margin-top: 20px;
            background: #fff;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #ddd;
            line-height: 1.7em;
        }
        .highlight {
            color: #0078d7;
            font-weight: bold;
        }
        hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 12px 0;
        }
    </style>
</head>
<body>
<h2>金额最大化购买计算器</h2>

<label>💰 可用总金额：</label>
<input id="total" type="text" placeholder="可输入如 100*3+50/2" />

<label>🛒 商品A单价：</label>
<input id="priceA" type="text" placeholder="可输入如 9.9*2，留空或0表示不买" />

<label>🛍️ 商品B单价：</label>
<input id="priceB" type="text" placeholder="可输入如 15+3，留空或0表示不买" />

<label>🎁 商品C单价：</label>
<input id="priceC" type="text" placeholder="可输入如 8.5/2，留空或0表示不买" />

<button onclick="calculate()">开始计算</button>

<div class="result" id="result"></div>

<script>
    // 安全求值函数：仅允许数字和运算符
    function safeEval(expr) {
        if (!expr || typeof expr !== 'string') return NaN;
        if (!/^[0-9+\-*/().\s]+$/.test(expr)) return NaN; // 防止注入
        try {
            return Function(`"use strict";return (${expr})`)();
        } catch (e) {
            return NaN;
        }
    }

    function calculate() {
        const total = safeEval(document.getElementById('total').value);
        let prices = [
            { name: "商品A", price: safeEval(document.getElementById('priceA').value) },
            { name: "商品B", price: safeEval(document.getElementById('priceB').value) },
            { name: "商品C", price: safeEval(document.getElementById('priceC').value) }
        ].filter(p => !isNaN(p.price) && p.price > 0); // 跳过0或无效价格

        const resultDiv = document.getElementById('result');

        if (isNaN(total) || total <= 0) {
            resultDiv.innerHTML = "<p style='color:red;'>❌ 请输入正确的总金额（支持 + - * / 表达式）</p>";
            return;
        }

        if (prices.length === 0) {
            resultDiv.innerHTML = "<p style='color:red;'>❌ 请至少输入一个有效商品价格！</p>";
            return;
        }

        // 穷举算法
        let best = { spent: 0, combo: [] };

        if (prices.length === 1) {
            const count = Math.floor(total / prices[0].price);
            best = { spent: count * prices[0].price, combo: [{ ...prices[0], count }] };
        } else if (prices.length === 2) {
            const [a, b] = prices;
            for (let i = 0; i <= Math.floor(total / a.price); i++) {
                const remain = total - i * a.price;
                const j = Math.floor(remain / b.price);
                const spent = i * a.price + j * b.price;
                if (spent > best.spent && spent <= total)
                    best = { spent, combo: [{ ...a, count: i }, { ...b, count: j }] };
            }
        } else if (prices.length === 3) {
            const [a, b, c] = prices;
            for (let i = 0; i <= Math.floor(total / a.price); i++) {
                const remain1 = total - i * a.price;
                for (let j = 0; j <= Math.floor(remain1 / b.price); j++) {
                    const remain2 = remain1 - j * b.price;
                    const k = Math.floor(remain2 / c.price);
                    const spent = i * a.price + j * b.price + k * c.price;
                    if (spent > best.spent && spent <= total)
                        best = { spent, combo: [{ ...a, count: i }, { ...b, count: j }, { ...c, count: k }] };
                }
            }
        }

        const left = (total - best.spent).toFixed(2);

        // 展示方案：先结论，再细节
        let resultHTML = `
        <p>✅ <b>最优购买结果</b></p>
        <p>💵 总花费：<span class="highlight">￥${best.spent.toFixed(2)}</span></p>
        <p>💡 剩余金额：<span class="highlight">￥${left}</span></p>
        <hr>
        <p><b>🧮 购买方案：</b></p>
      `;

        resultHTML += best.combo.map(p => {
            const itemSpent = (p.count * p.price).toFixed(2);
            return `<p>${p.name}：<span class="highlight">${p.count}</span> 件 × ￥${p.price.toFixed(2)} = ￥${itemSpent}</p>`;
        }).join('');

        resultDiv.innerHTML = resultHTML;
    }
</script>
</body>
</html>
