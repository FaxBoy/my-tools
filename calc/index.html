<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é‡‘é¢æœ€å¤§åŒ–è´­ä¹°è®¡ç®—å™¨ï¼ˆä¸‰æ¬¾å•†å“ + è¡¨è¾¾å¼ + è‡ªåŠ¨è·³è¿‡0ï¼‰</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background: #f5f6fa;
            color: #333;
            max-width: 540px;
            margin: 40px auto;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            color: #0078d7;
            margin-bottom: 24px;
        }
        label {
            display: block;
            margin: 10px 0 4px;
        }
        input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 15px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            margin-top: 18px;
            padding: 10px;
            background: #0078d7;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #005ea6;
        }
        .result {
            margin-top: 20px;
            background: #fff;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #ddd;
            line-height: 1.7em;
        }
        .highlight {
            color: #0078d7;
            font-weight: bold;
        }
        hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 12px 0;
        }
    </style>
</head>
<body>
<h2>é‡‘é¢æœ€å¤§åŒ–è´­ä¹°è®¡ç®—å™¨</h2>

<label>ğŸ’° å¯ç”¨æ€»é‡‘é¢ï¼š</label>
<input id="total" type="text" placeholder="å¯è¾“å…¥å¦‚ 100*3+50/2" />

<label>ğŸ›’ å•†å“Aå•ä»·ï¼š</label>
<input id="priceA" type="text" placeholder="å¯è¾“å…¥å¦‚ 9.9*2ï¼Œç•™ç©ºæˆ–0è¡¨ç¤ºä¸ä¹°" />

<label>ğŸ›ï¸ å•†å“Bå•ä»·ï¼š</label>
<input id="priceB" type="text" placeholder="å¯è¾“å…¥å¦‚ 15+3ï¼Œç•™ç©ºæˆ–0è¡¨ç¤ºä¸ä¹°" />

<label>ğŸ å•†å“Cå•ä»·ï¼š</label>
<input id="priceC" type="text" placeholder="å¯è¾“å…¥å¦‚ 8.5/2ï¼Œç•™ç©ºæˆ–0è¡¨ç¤ºä¸ä¹°" />

<button onclick="calculate()">å¼€å§‹è®¡ç®—</button>

<div class="result" id="result"></div>

<script>
    // å®‰å…¨æ±‚å€¼å‡½æ•°ï¼šä»…å…è®¸æ•°å­—å’Œè¿ç®—ç¬¦
    function safeEval(expr) {
        if (!expr || typeof expr !== 'string') return NaN;
        if (!/^[0-9+\-*/().\s]+$/.test(expr)) return NaN; // é˜²æ­¢æ³¨å…¥
        try {
            return Function(`"use strict";return (${expr})`)();
        } catch (e) {
            return NaN;
        }
    }

    function calculate() {
        const total = safeEval(document.getElementById('total').value);
        let prices = [
            { name: "å•†å“A", price: safeEval(document.getElementById('priceA').value) },
            { name: "å•†å“B", price: safeEval(document.getElementById('priceB').value) },
            { name: "å•†å“C", price: safeEval(document.getElementById('priceC').value) }
        ].filter(p => !isNaN(p.price) && p.price > 0); // è·³è¿‡0æˆ–æ— æ•ˆä»·æ ¼

        const resultDiv = document.getElementById('result');

        if (isNaN(total) || total <= 0) {
            resultDiv.innerHTML = "<p style='color:red;'>âŒ è¯·è¾“å…¥æ­£ç¡®çš„æ€»é‡‘é¢ï¼ˆæ”¯æŒ + - * / è¡¨è¾¾å¼ï¼‰</p>";
            return;
        }

        if (prices.length === 0) {
            resultDiv.innerHTML = "<p style='color:red;'>âŒ è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆå•†å“ä»·æ ¼ï¼</p>";
            return;
        }

        // ç©·ä¸¾ç®—æ³•
        let best = { spent: 0, combo: [] };

        if (prices.length === 1) {
            const count = Math.floor(total / prices[0].price);
            best = { spent: count * prices[0].price, combo: [{ ...prices[0], count }] };
        } else if (prices.length === 2) {
            const [a, b] = prices;
            for (let i = 0; i <= Math.floor(total / a.price); i++) {
                const remain = total - i * a.price;
                const j = Math.floor(remain / b.price);
                const spent = i * a.price + j * b.price;
                if (spent > best.spent && spent <= total)
                    best = { spent, combo: [{ ...a, count: i }, { ...b, count: j }] };
            }
        } else if (prices.length === 3) {
            const [a, b, c] = prices;
            for (let i = 0; i <= Math.floor(total / a.price); i++) {
                const remain1 = total - i * a.price;
                for (let j = 0; j <= Math.floor(remain1 / b.price); j++) {
                    const remain2 = remain1 - j * b.price;
                    const k = Math.floor(remain2 / c.price);
                    const spent = i * a.price + j * b.price + k * c.price;
                    if (spent > best.spent && spent <= total)
                        best = { spent, combo: [{ ...a, count: i }, { ...b, count: j }, { ...c, count: k }] };
                }
            }
        }

        const left = (total - best.spent).toFixed(2);

        // å±•ç¤ºæ–¹æ¡ˆï¼šå…ˆç»“è®ºï¼Œå†ç»†èŠ‚
        let resultHTML = `
        <p>âœ… <b>æœ€ä¼˜è´­ä¹°ç»“æœ</b></p>
        <p>ğŸ’µ æ€»èŠ±è´¹ï¼š<span class="highlight">ï¿¥${best.spent.toFixed(2)}</span></p>
        <p>ğŸ’¡ å‰©ä½™é‡‘é¢ï¼š<span class="highlight">ï¿¥${left}</span></p>
        <hr>
        <p><b>ğŸ§® è´­ä¹°æ–¹æ¡ˆï¼š</b></p>
      `;

        resultHTML += best.combo.map(p => {
            const itemSpent = (p.count * p.price).toFixed(2);
            return `<p>${p.name}ï¼š<span class="highlight">${p.count}</span> ä»¶ Ã— ï¿¥${p.price.toFixed(2)} = ï¿¥${itemSpent}</p>`;
        }).join('');

        resultDiv.innerHTML = resultHTML;
    }
</script>
</body>
</html>
